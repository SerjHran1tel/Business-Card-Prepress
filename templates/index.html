<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Раскладка визиток - Business Card Imposition</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Раскладка визиток</h1>
            <p>Автоматизация процесса импозиции визиток на печатные листы</p>
        </header>

        <div class="content">
            <!-- Загрузка файлов -->
            <div class="section">
                <div class="section-title">1. Загрузка файлов</div>

                <div class="form-group">
                    <label for="frontFiles">Лицевая сторона визиток *</label>
                    <input type="file" id="frontFiles" multiple accept=".pdf,.jpg,.jpeg,.png,.tiff,.tif,.eps">
                    <div id="frontFilesList" class="file-list hidden"></div>
                </div>

                <div class="form-group">
                    <label for="backFiles">Оборотная сторона визиток (опционально)</label>
                    <input type="file" id="backFiles" multiple accept=".pdf,.jpg,.jpeg,.png,.tiff,.tif,.eps">
                    <div id="backFilesList" class="file-list hidden"></div>
                </div>

                <div class="form-group">
                    <label for="matchingMode">Режим сопоставления</label>
                    <select id="matchingMode">
                        <option value="one_to_one">Один к одному (каждой лицевой - своя оборотная)</option>
                        <option value="one_to_many">Один ко многим (одна оборотная для всех)</option>
                        <option value="many_to_many">Многие ко многим</option>
                    </select>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="strictMatching" checked>
                        <label for="strictMatching" style="margin: 0;">Строгое совпадение имен файлов (лицо/оборот должны иметь одинаковые имена)</label>
                    </div>
                </div>
            </div>

            <!-- Параметры печати -->
            <div class="section">
                <div class="section-title">2. Параметры печати</div>

                <div class="grid">
                    <div class="form-group">
                        <label for="pageFormat">Формат листа</label>
                        <select id="pageFormat">
                            <option value="A4">A4 (210x297 мм)</option>
                            <option value="A3">A3 (297x420 мм)</option>
                            <option value="SRA3">SRA3 (320x450 мм)</option>
                            <option value="SRA4">SRA4 (225x320 мм)</option>
                            <option value="custom">Произвольный</option>
                        </select>
                    </div>

                    <div class="form-group hidden" id="customPageGroup">
                        <label>Размер листа (мм)</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="number" id="customPageWidth" placeholder="Ширина" value="210">
                            <input type="number" id="customPageHeight" placeholder="Высота" value="297">
                        </div>
                    </div>
                </div>

                <div class="grid">
                    <div class="form-group">
                        <label for="cardSize">Размер визитки</label>
                        <select id="cardSize">
                            <option value="Standard RU">Standard RU (90x50 мм)</option>
                            <option value="Standard EU">Standard EU (85x55 мм)</option>
                            <option value="Standard US">Standard US (89x51 мм)</option>
                            <option value="Square">Square (70x70 мм)</option>
                            <option value="custom">Произвольный</option>
                        </select>
                    </div>

                    <div class="form-group hidden" id="customCardGroup">
                        <label>Размер визитки (мм)</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="number" id="customCardWidth" placeholder="Ширина" value="90">
                            <input type="number" id="customCardHeight" placeholder="Высота" value="50">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Дополнительные настройки -->
            <div class="section">
                <div class="section-title">3. Дополнительные настройки</div>

                <div class="grid">
                    <div class="form-group">
                        <label for="marginTop">Поле сверху (мм)</label>
                        <input type="number" id="marginTop" value="10" min="0" step="0.5">
                    </div>
                    <div class="form-group">
                        <label for="marginBottom">Поле снизу (мм)</label>
                        <input type="number" id="marginBottom" value="10" min="0" step="0.5">
                    </div>
                    <div class="form-group">
                        <label for="marginLeft">Поле слева (мм)</label>
                        <input type="number" id="marginLeft" value="10" min="0" step="0.5">
                    </div>
                    <div class="form-group">
                        <label for="marginRight">Поле справа (мм)</label>
                        <input type="number" id="marginRight" value="10" min="0" step="0.5">
                    </div>
                </div>

                <div class="grid">
                    <div class="form-group">
                        <label for="bleed">Вылеты (мм)</label>
                        <input type="number" id="bleed" value="3" min="0" step="0.5">
                    </div>
                    <div class="form-group">
                        <label for="gap">Зазор между визитками (мм)</label>
                        <input type="number" id="gap" value="2" min="0" step="0.5">
                    </div>
                </div>

                <div class="grid">
                    <div class="form-group">
                        <label for="dpi">Разрешение изображений (DPI)</label>
                        <input type="number" id="dpi" value="300" min="72" max="600" step="1">
                    </div>
                    <div class="form-group">
                        <label for="outputDpi">Разрешение PDF (DPI)</label>
                        <input type="number" id="outputDpi" value="300" min="150" max="1200" step="1">
                    </div>
                </div>

                <div class="form-group">
                    <label for="colorMode">Цветовой режим</label>
                    <select id="colorMode">
                        <option value="rgb">RGB (для цифровой печати)</option>
                        <option value="cmyk">CMYK (для офсетной печати)</option>
                    </select>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="cropMarks" checked>
                        <label for="cropMarks" style="margin: 0;">Добавить обрезные метки</label>
                    </div>
                </div>
            </div>

            <!-- Предпросмотр -->
            <div class="section">
                <div class="section-title">4. Предпросмотр раскладки</div>
                <button class="btn btn-secondary" onclick="generatePreview()">Показать предпросмотр</button>

                <div id="previewInfo"></div>

                <div id="previewContainer" class="preview-container">
                    <canvas id="previewCanvas" class="preview-canvas"></canvas>

                    <div class="preview-cards">
                        <div class="preview-side">
                            <div class="preview-side-title">Лицевая сторона</div>
                            <div id="frontPreviewGrid" class="preview-grid"></div>
                        </div>
                        <div class="preview-side">
                            <div class="preview-side-title">Оборотная сторона</div>
                            <div id="backPreviewGrid" class="preview-grid"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Прогресс обработки -->
            <div id="progressContainer" class="progress-container hidden">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <div id="progressText" class="progress-text">Инициализация...</div>
            </div>

            <!-- Сообщения -->
            <div id="messages"></div>
            <div class="loader" id="loader"></div>

            <!-- Кнопки действий -->
            <div class="button-group">
                <button class="btn btn-primary" id="processBtn" onclick="processFiles()">
                    Создать PDF
                </button>
                <button class="btn btn-success hidden" id="downloadBtn" onclick="downloadFile()">
                    Скачать готовый файл
                </button>
            </div>
        </div>

        <footer>
            <p>Business Card Imposition System © 2025</p>
            <p style="font-size: 0.9rem; margin-top: 10px;">Поддерживаемые форматы: PDF, JPG, PNG, TIFF, EPS</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>